# 딥러닝 기반 야간→낮 이미지 변환 (배경 옵션 4)

**목적**: 야간 이미지들을 입력받아 낮처럼 자연스럽고 리얼한 이미지로 변환

---

## 1. 데이터셋 구축

### 1-1. 데이터 수집 전략

#### 공통 요구사항
- **동일 장면**에서 시간대별로 촬영하여 픽셀 단위 정렬(alignment) 필요
- Arma 3 게임 환경에서 카메라 위치/각도 고정
- 사막 맵 환경 일관성 유지

#### 🔹 옵션 A: 배경(사람 없음) 데이터셋
**촬영 구성**:
```
동일 장면 (배경만):
├─ Input 1: (21:00) 야간 가시광 (어두운 원본)
├─ Input 2: (21:00) 야간투시 이미지
└─ Target:  (12:00) 주간 가시광 (Ground Truth)
```

**장점**:
- 순수한 환경/조명 변환 학습에 집중
- 객체(사람) 없이 깔끔한 매핑 가능
- 일반화 성능이 좋을 가능성 (배경에만 집중)

**단점**:
- 실제 사용 시나리오(사람 탐지)와 괴리
- 사람이 있는 영역의 변환 품질 불확실

#### 🔹 옵션 B: 사람 포함 데이터셋
**촬영 구성**:
```
동일 장면 (사람 포함):
├─ Input 1: (21:00) 야간 가시광 (사람이 어둡게 보임)
├─ Input 2: (21:00) 야간투시 이미지 (사람 선명)
└─ Target:  (12:00) 주간 가시광 (사람 명확)
```

**장점**:
- 실제 적용 환경과 동일 (사람 탐지 목적)
- 사람 영역의 디테일 복원 학습 가능
- End-to-end로 실전 성능 보장

**단점**:
- 사람 위치/자세가 주야간에 완전히 동일해야 함 (정렬 어려움)
- 데이터 수집 난이도 증가

#### 🔸 옵션 C: 혼합 전략 (권장)
```
데이터셋 구성:
├─ 70%: 배경만 (다양한 장소/조명)
└─ 30%: 사람 포함 (다양한 자세/위치)
```

**이유**:
- 배경 변환 기본 능력 + 사람 영역 특화 학습
- 일반화와 실전 성능 모두 확보

### 1-2. 데이터 전처리

1. **야간 가시광 Enhancement** (Input 1 준비)
   - Zero-DCE, 감마 보정, 히스토그램 평활화 등 적용
   - 목적: 완전히 검은 이미지가 아닌 약간의 정보가 있는 상태로 만들기

2. **이미지 정렬(Alignment)**
   - 주간/야간 이미지 픽셀 단위 정렬 확인
   - Arma 3 스크린샷 위치 고정으로 자동 정렬됨

3. **해상도 조정**
   - 학습용: 256×256 또는 512×512
   - 추론용: 원본 해상도 (1920×1080 등)

### 1-3. 데이터 분할
```
전체 데이터:
├─ Train: 70% (모델 학습)
├─ Validation: 15% (하이퍼파라미터 튜닝)
└─ Test: 15% (최종 평가)
```

---

## 2. 모델 아키텍처 후보

### 2-1. Pix2Pix (Conditional GAN)
- **입력**: Enhanced 가시광 + 야간투시 (4채널 또는 6채널)
- **출력**: RGB 낮 이미지 (3채널)
- **장점**: Paired 데이터에 최적화, 학습 안정적
- **단점**: Paired 데이터 필수

### 2-2. CycleGAN (Unpaired)
- **장점**: 주야간 이미지만 있으면 됨 (정렬 불필요)
- **단점**: 멀티 입력(야간투시 포함) 처리 복잡

### 2-3. Diffusion Model (이상적)
- **예**: Stable Diffusion, ControlNet
- **장점**: 최고 품질, 디테일 복원 우수
- **단점**: 학습 리소스 많이 필요, 느림

### 2-4. Transformer 기반
- **예**: SwinIR, Restormer
- **장점**: 장거리 의존성 학습, 최신 기법
- **단점**: 계산량 많음

---

## 3. 학습 설정

### 3-1. Loss Functions
```python
Total_Loss = λ1 × L1_Loss + λ2 × Perceptual_Loss + λ3 × GAN_Loss

- L1_Loss: 픽셀 단위 차이 (색상 정확도)
- Perceptual_Loss: VGG 특징 기반 (자연스러움)
- GAN_Loss: 진짜 같은 이미지 생성
```

### 3-2. 하이퍼파라미터
- Batch size: 4~16
- Learning rate: 0.0001~0.0002
- Epochs: 100~200
- Optimizer: Adam

---

## 4. 평가 지표

### 4-1. 정량적 평가
```
1. PSNR (Peak Signal-to-Noise Ratio)
   - 픽셀 단위 정확도
   - 높을수록 좋음 (>25dB 목표)

2. SSIM (Structural Similarity Index)
   - 구조적 유사도
   - 1에 가까울수록 좋음 (>0.8 목표)

3. LPIPS (Learned Perceptual Image Patch Similarity)
   - 인간 지각 기반 유사도
   - 낮을수록 좋음 (<0.2 목표)

4. FID (Fréchet Inception Distance)
   - 생성 이미지 품질
   - 낮을수록 좋음 (<50 목표)
```

### 4-2. 정성적 평가
```
1. 시각적 품질 검사
   - 색상 자연스러움
   - 디테일 보존 정도
   - 아티팩트(왜곡) 여부

2. 실전 적용 테스트
   - 변환된 이미지에서 객체 탐지 성능 확인
   - YOLO 모델 적용 후 mAP 측정

3. 사용자 연구 (선택적)
   - A/B 테스트: 실제 낮 vs 변환 이미지
   - 구별 가능한지 평가
```

### 4-3. 특수 평가 (사람 영역 집중)
```
사람 바운딩 박스 영역만 추출하여 별도 평가:
- Person PSNR/SSIM: 사람 영역의 복원 품질
- Person Detection mAP: 변환 후 탐지 성능
```

---

## 5. 실험 고려사항

### 🤔 미결정 사항

#### **이슈 1: 데이터 구성**
- [ ] 옵션 A: 배경만
- [ ] 옵션 B: 사람 포함
- [ ] 옵션 C: 혼합 (70% 배경 + 30% 사람)

**권장**: 옵션 C로 시작 → 결과 보고 조정

#### **이슈 2: 열상 입력 포함 여부**
```
Case 1 (기본): Enhanced 가시광 + 야간투시 → 낮 가시광
Case 2 (확장): Enhanced 가시광 + 야간투시 + 열상 → 낮 가시광
```

**실험 계획**: 
1. Case 1로 먼저 학습
2. 성능 부족 시 Case 2 시도 (열상이 힌트 제공)

---

## 6. 기대 효과

1. **최고 품질의 시각화**: 야간 탐지 결과를 낮처럼 보이는 이미지에 표시
2. **사용자 경험 개선**: 어두운 야간투시보다 자연스러운 화면 제공
3. **추가 연구 가능성**: 변환 이미지로 데이터 증강, 도메인 적응 등

---

## 7. 다음 단계

1. [ ] 데이터 수집 방식 결정 (배경 vs 사람 포함 vs 혼합)
2. [ ] Arma 3에서 주야간 paired 데이터셋 수집
3. [ ] Baseline 모델(Pix2Pix) 구현 및 학습
4. [ ] 정량/정성 평가 수행
5. [ ] 고급 모델(Diffusion 등) 실험
6. [ ] 객체 탐지 파이프라인과 통합